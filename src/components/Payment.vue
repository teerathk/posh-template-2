<template>
<div>
    <header-comp></header-comp>
    <!-- banner Section start -->
    <section class="banner-container top-inner-container">
        <div class="container">
            <div class="row g-0">
                <div class="col-9">
                    <div class="category-search">
                        <form action="">
                            <div class="select-category-box">
                                <select>
                                    <option>All categories</option>
                                    <option>Fashion</option>
                                    <option>Computer</option>
                                    <option>Furniture</option>
                                    <option>Smartphone</option>
                                    <option>Healthy & Beauty</option>
                                    <option>Sport Clothing</option>
                                    <option>Watch & Jewelry</option>
                                    <option>Kitchen</option>
                                    <option>Accessories</option>
                                    <option>More Category</option>
                                </select>
                            </div>
                            <div class="search-box">
                                <input type="search" name="" placeholder="Search entire store here...">
                            </div>
                            <div class="search-tab">
                                <button type="submit">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-3">
                    <div class="right-banner-section">
                        <div class="shopping-cart">
                            <div class="wish-i">
                                <a href="#">
                                    <img src="/src/assets/images/wish-i.jpg" alt="">
                                </a>
                            </div>
                            <div class="wish-i">
                                <a href="#">
                                    <img src="/src/assets/images/refresh-i.jpg" alt="">
                                </a>
                            </div>
                            <div class="wish-i">
                                <span class="cart">
                                    2
                                </span>
                                <img src="/src/assets/images/cart-i.jpg" alt="">
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- banner Section End -->
    <div class="sec-nav">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    <div class="show-all-cat">
                        <span><img src="/src/assets/img/menu-template/category.png">Show All Categories <i class="fa fa-chevron-down"></i></span>
                        <ul>
                            <li>Cat A</li>
                            <li>Cat B</li>
                            <li>Cat C</li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="order-track">
                        <ul>
                            <li><a href="#">Track Your Order</a></li>
                            <li><a href="#">Help Center</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="container-fluid">
				<div class="checkout-itesm-bx">
                    
					<div class="row mt-4">
						<div class="col-12">
							<h4><strong>Checkout</strong> <span>(2 Items)</span></h4>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-8">
							<div class="cartIBilling-shipping">
								<div class="row">
									<div class="col-sm-12">
									<div class="checkout-process">
										<ul class="checkout-method">
										<li class="shipping-pay active"><div class="step-counter-point"></div><div class="step-name">Shipping</div></li>
										<li class="shipping-pay active"><div class="step-counter-point"></div><div class="step-name">Payment</div></li>
										</ul>
									</div>
										<div class="ba-title"><h4>Payment</h4></div>
										
									</div>
									
								</div>
								<div class="row">
									<div class="col-sm-12">
										<div class="checkout-payment-bx">
											
											<div class="checkout-payment-info">
											<ul class="products-cat-opt ">
												<li><label class="form-check-label"><input type="radio" class="form-check-input" name="" checked>Credit Card<span class="checkmark_radio"></span></label></li>
											</ul>
											<div class="carInput-fileds">
											<div class="form-group mb-4 creditcardNo">
												<input type="text" placeholder="0000 0000 0000 0000*">
												<img src="../assets/img/credit-card-icon.png" class="credit-card-icon">
											</div>
											<div class="form-group select-month">
													<select class="select-custom-point">
															<option>MM</option>
															<option>Jan</option>
															<option>Feb</option>
															<option>Mar</option>
															<option>Apr</option>
													</select>
											</div>
											<div class="form-group select-year">
													<select class="select-custom-point">
															<option>YYYY</option>
															<option>2020</option>
															<option>2021</option>
															<option>2022</option>
													</select>
											</div>
											<div class="form-group mb-4 select-cvv">
												<input type="text" placeholder="CVV">
												<i class="credit-card-icon"></i>
											</div>
											<div class="form-group mb-4 ">
												<input type="text" placeholder="Card Holder Name">
												<i class="credit-card-icon"></i>
											</div>
											</div>
											<p class="check-txt-pra">Your card details except CVV would be securely saved for faster payments.</p>
										</div>
										<div class="paypal-box">
										<ul class="products-cat-opt">
												<li><label class="form-check-label"><input type="radio" class="form-check-input">PayPal<span class="checkmark_radio"></span></label></li>
											</ul>
											<img src="../assets/img/paypal-icon.png" class="img-paypal">
										</div>
										<div class="col-12">
											<button class="primary nxtbtn" v-on:click="placeorder">PLACE ORDER</button></div>
										</div>
									</div>
								</div>
                            </div>
                        </div>
                    
				
						<div class="col-sm-4">
							<div class="cartSummary-bx shipping-right">
								<div class="cartsum-title">Your Order</div>
            <div class="youorder-opt-bx" v-for="items in cartitemslist" :key="items.id">
              <img src="../assets/img/cart-item-1.png" alt="" />
              <div class="youorder-item">
                <h5>{{items.name}}</h5>
                <div class="yr-disc">
                  <div class="yr-disc-bx">Color <strong>Black</strong></div>
                  <div class="yr-disc-bx2">
                    Screen Size <strong>15.6</strong>
                  </div>
                </div>
                <div class="">$<strong>{{items.item_price}}</strong> X {{items.quantity}}</div>
              </div>
            </div>
								 <div class="cartSum-list">
              <div class="cartSummary-items">
                <div class="csi-title">Item(s)</div>
                <div class="csi-title-amount">$<strong>{{this.total_price}}</strong></div>
              </div>
              <div class="cartSummary-items">
                <div class="csi-title">Est. Delivery</div>
                <div class="csi-title-amount">$<strong>28</strong></div>
              </div>
              <div class="cartSummary-items bt-0">
                <div class="csi-title">Discount</div>
                <div class="csi-title-amount">-$<strong> 10.00</strong></div>
              </div>
              <div class="cartSummary-items justify-sbetw pt-4">
                <div class="csi-title-t">Total</div>
                <div class="csi-total-amount">$<strong>{{ total_price+28+10 }}</strong></div>
              </div>
             
            </div>					
							</div>
						</div>
                    </div>
                </div>

   
    </div>
    <footer-comp></footer-comp>
</div>     
</template>

<script>


import HeaderComp from './Header.vue'
import FooterComp from "./Footer.vue";
import axios from "axios"
export default {
  name: "Payment",
  components: {
      HeaderComp, FooterComp
  },
    async mounted() {
    this.loadSession();
	this.getCartData();	
  },

  data() {
    return {
		user_id : null,
		cartitemslist:[],
		count_cartitems:0,
		total_price:0,
		count:0,
    userdetails:[]
    };
  },
  methods: {
	  async placeorder(){
		  this.startLoader();
		  axios.post(axios.defaults.baseURL+"placeorder", {
			  user_id:this.user_id
		  })
		  this.$router.push("success") 
		  this.EndLoader();
	  },

loadSession(){
		if(localStorage.getItem("login")){
			console.log("Login Data")
			const logindata = JSON.parse(localStorage.getItem("login"));
			console.log(logindata.id);
			this.user_id = logindata.id;			
		}
	  },
	async getCartData() {
		this.startLoader();
		this.total_price = 0;
		this.count = 0
		let result = axios.post(
		axios.defaults.baseURL + "usercartdata",
		{
				user_id: this.user_id
		},
		{ 
			useCredentails: true 
		}
		);
		console.log("Cart Check Data2");
		console.log((await result).data);
		
		this.cartitemslist = (await result).data;	
		
		var totalQty=0;
		var tempTotalPrice=0;
		this.count_cartitems = this.cartitemslist.length;
		this.cartitemslist.forEach(function(items) {
			console.log("Qty: "+items.quantity)
			totalQty+=items.quantity
			tempTotalPrice+=(items.quantity*items.item_price)
			
		})
		this.total_price = tempTotalPrice
		//this.itemsincart=totalQty;
		$(".cartitems").children("span").html(totalQty);

		if(localStorage.getItem("login")){
			console.log("Login Data")
			const logindata = JSON.parse(localStorage.getItem("login"));
			this.user_id = logindata.id;			
			logindata.cartitems=this.cartitemslist;
			localStorage.setItem("login", JSON.stringify(logindata));
		}
		

		//this.count_cartitems = this.cartitemslist.length
		this.EndLoader();
	},	
		startLoader() {
		console.log("karachi");
		var target_ContId = document.getElementById("loader-container");
		target_ContId.style.display = "block";
	},
	EndLoader() {
		console.log("pak");
		var target_ContId = document.getElementById("loader-container");
		target_ContId.style.display = "none";
	},
  
  }
};
</script>